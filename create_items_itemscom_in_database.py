from database.database import get_session
from models.models import Item, ItemCompound

async def save_data(data, costs):
    async with get_session() as session:
        for item_name, elements in data.items():
            new_item = Item(name=item_name)
            cost = 0.0
            
            session.add(new_item)
            await session.flush()

            for element_name, quantities in elements.items():
                
                for quantity in quantities:
                    
                    for name, price in costs.items():
                        if name == element_name:
                            cost +=price * quantity

                    new_compound = ItemCompound(
                        name=element_name, quantity=quantity, item_id=new_item.item_id
                    )
                    session.add(new_compound)
            
            new_item.cost = round(cost, 2)
                
        await session.commit()

costs = {
  "60": 0.83, 
  "330": 4.23,
  "1090": 12.72,
  "2240": 27.59,
  "3880": 42.46,
  "8080": 84.94
}

data = {
  "60": {
    "60": [1]
  },
  "330": {
    "330": [1]
  },
  "660": {
      "330": [2]
  },
  "1090": {
    "1090": [1]
  },
  "2240": {
    "2240": [1]
  },
  "3880": {
    "3880": [1]
  },
  "120": {
    "60": [2]
  },
  "390": {
    "330": [1],
    "60": [1]
  },
  "1150": {
    "1090": [1],
    "60": [1]
  },
  "1420": {
    "1090": [1],
    "330": [1]
  },
  "2180": {
    "1090": [2]
  },
  "180": {
    "60": [3]
  },
  "450": {
    "330": [1],
    "60": [2]
  },
  "720": {
    "330": [2],
    "60": [1]
  },
  "990": {
    "330": [3]
  },
  "1210": {
    "1090": [1],
    "60": [2]
  },
  "1480": {
    "1090": [1],
    "330": [1],
    "60": [1]
  },
  "1750": {
    "1090": [1],
    "330": [2]
  },
  "2360": {
    "2240": [1],
    "60": [2]
  },
  "2510": {
    "1090": [2],
    "330": [1]
  },
  "2630": {
    "2240": [1],
    "330": [1],
    "60": [1]
  },
  "2900": {
    "2240": [1],
    "330": [2]
  },
  "3270": {
    "1090": [3]
  },
  "3390": {
    "2240": [1],
    "1090": [1],
    "60": [1]
  },
  "3660": {
    "2240": [1],
    "1090": [1],
    "330": [1]
  },
  "4000": {
    "3880": [1],
    "60": [2]
  },
  "4270": {
    "3880": [1],
    "330": [1],
    "60": [1]
  },
  "4540": {
    "3880": [1],
    "330": [2]
  },
  "5030": {
    "3880": [1],
    "1090": [1],
    "60": [1]
  },
  "5300": {
    "3880": [1],
    "1090": [1],
    "330": [1]
  },
  "6060": {
    "3880": [1],
    "1090": [2]
  },
  "6180": {
    "3880": [1],
    "2240": [1],
    "60": [1]
  },
  "6450": {
    "3880": [1],
    "2240": [1],
    "330": [1]
  },
  "7210": {
    "3880": [1],
    "2240": [1],
    "1090": [1]
  },
  "7820": {
    "3880": [2],
    "60": [1]
  },
  "8090": {
    "3880": [2],
    "330": [1]
  },
  "8200": {
    "8080": [1],
    "60": [2]
  },
  "8470": {
    "8080": [1],
    "330": [1],
    "60": [1]
  },
  "8740": {
    "8080": [1],
    "330": [2]
  },
  "8850": {
    "3880": [2],
    "1090": [1]
  },
  "9230": {
    "8080": [1],
    "1090": [1],
    "60": [1]
  },
  "9500": {
    "8080": [1],
    "1090": [1],
    "330": [1]
  },
  "10260": {
    "8080": [1],
    "1090": [2]
  },
  "10380": {
    "8080": [1],
    "2240": [1],
    "60": [1]
  },
  "10650": {
    "8080": [1],
    "2240": [1],
    "330": [1]
  },
  "11410": {
    "8080": [1],
    "2240": [1],
    "1090": [1]
  },
  "12020": {
    "8080": [1],
    "3880": [1],
    "60": [1]
  },
  "12290": {
    "8080": [1],
    "3880": [1],
    "330": [1]
  },
}


import asyncio
asyncio.run(save_data(data, costs))